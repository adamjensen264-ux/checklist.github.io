<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Checklist</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#111;
    color:white;
    display:flex;
    justify-content:center;
    padding-top:40px;
}

.container {
    background:#1c1c1c;
    padding:25px;
    border-radius:12px;
    width:380px;
}

h1 { text-align:center; }

.task {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:8px 0;
}

button {
    background:#333;
    border:none;
    color:white;
    padding:6px 10px;
    border-radius:6px;
    cursor:pointer;
}

button:hover { background:#555; }

input[type="text"] {
    width:70%;
    padding:6px;
}

.controls {
    margin-top:15px;
    display:flex;
    gap:8px;
}

.small {
    font-size:13px;
    color:#aaa;
    text-align:center;
    margin-top:10px;
}
</style>
</head>

<body>

<div class="container">
<h1>Daily Checklist</h1>

<div id="taskList"></div>

<div class="controls">
    <input id="newTask" type="text" placeholder="New task...">
    <button onclick="addTask()">Add</button>
</div>

<hr>

<div>
    Reset Time:
    <input type="time" id="resetTime">
</div>

<div class="controls">
    <button onclick="manualReset()">Reset Now</button>
</div>

<div class="small" id="info"></div>

</div>

<script>
const TASK_KEY = "tasks";
const RESET_TIME_KEY = "resetTime";
const LAST_RESET_KEY = "lastReset";

/* ---------- STORAGE ---------- */

function getTasks() {
    return JSON.parse(localStorage.getItem(TASK_KEY)) || [
        {text:"Workout", checked:false},
        {text:"Drink Water", checked:false},
        {text:"Read", checked:false}
    ];
}

function saveTasks(tasks){
    localStorage.setItem(TASK_KEY, JSON.stringify(tasks));
}

/* ---------- RENDER ---------- */

function render() {
    const list = document.getElementById("taskList");
    list.innerHTML = "";

    const tasks = getTasks();

    tasks.forEach((task, index) => {

        const div = document.createElement("div");
        div.className = "task";

        const label = document.createElement("label");

        const checkbox = document.createElement("input");
        checkbox.type="checkbox";
        checkbox.checked = task.checked;

        checkbox.onchange = () => {
            tasks[index].checked = checkbox.checked;
            saveTasks(tasks);
        };

        label.appendChild(checkbox);
        label.append(" " + task.text);

        const delBtn = document.createElement("button");
        delBtn.textContent="âœ•";
        delBtn.onclick = () => {
            tasks.splice(index,1);
            saveTasks(tasks);
            render();
        };

        div.appendChild(label);
        div.appendChild(delBtn);
        list.appendChild(div);
    });

    updateInfo();
}

/* ---------- TASK MANAGEMENT ---------- */

function addTask(){
    const input = document.getElementById("newTask");
    const text = input.value.trim();
    if(!text) return;

    const tasks = getTasks();
    tasks.push({text, checked:false});
    saveTasks(tasks);

    input.value="";
    render();
}

/* ---------- RESET ---------- */

function manualReset(){
    const tasks = getTasks();
    tasks.forEach(t => t.checked=false);
    saveTasks(tasks);

    localStorage.setItem(LAST_RESET_KEY, Date.now());
    render();
}

function getResetMinutes(){
    const value = localStorage.getItem(RESET_TIME_KEY) || "04:00";
    const [h,m] = value.split(":").map(Number);
    return h*60+m;
}

function checkDailyReset(){
    const lastReset = Number(localStorage.getItem(LAST_RESET_KEY)||0);

    const now = new Date();
    const minutesNow = now.getHours()*60 + now.getMinutes();
    const resetMinutes = getResetMinutes();

    const todayReset = new Date();
    todayReset.setHours(0,0,0,0);
    todayReset.setMinutes(resetMinutes);

    if(minutesNow < resetMinutes){
        todayReset.setDate(todayReset.getDate()-1);
    }

    if(lastReset < todayReset.getTime()){
        manualReset();
        localStorage.setItem(LAST_RESET_KEY, todayReset.getTime());
    }
}

/* ---------- RESET TIME UI ---------- */

const resetInput = document.getElementById("resetTime");

function loadResetTime(){
    const saved = localStorage.getItem(RESET_TIME_KEY) || "04:00";
    resetInput.value = saved;
}

resetInput.addEventListener("change", ()=>{
    localStorage.setItem(RESET_TIME_KEY, resetInput.value);
    updateInfo();
});

/* ---------- INFO ---------- */

function updateInfo(){
    const time = localStorage.getItem(RESET_TIME_KEY) || "04:00";
    document.getElementById("info").textContent =
        `Checklist resets daily at ${time}`;
}

/* ---------- INIT ---------- */

loadResetTime();
checkDailyReset();
render();

</script>

</body>
</html>
