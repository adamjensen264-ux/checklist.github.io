<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Checklist with Custom Tasks</title>
<style>
body {
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#111;
  color:white;
  text-align:center;
}

.container {
  max-width:700px;
  margin:40px auto;
  background:#1e1e1e;
  padding:20px;
  border-radius:10px;
}

ul { list-style:none; padding:0; }

li {
  background:#2a2a2a;
  margin:6px 0;
  padding:8px;
  border-radius:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:grab;
}

button {
  padding:6px 10px;
  margin:4px;
  border:none;
  border-radius:6px;
  background:#6b5cff;
  color:white;
  cursor:pointer;
}

input[type=text], input[type=date], input[type=time] {
  padding:6px;
}
.editBtn {
  background:#ffb400;
  margin-left:6px;
}
</style>
</head>
<body>

<div class="container">
<h2>Daily Checklist with Custom Tasks</h2>

<label>Select Date:</label>
<input type="date" id="datePicker"><br><br>

<h3>Daily Tasks</h3>
<ul id="dailyList"></ul>

<h3>Custom Tasks</h3>
<input type="text" id="customTaskInput" placeholder="New custom task">
<button id="addCustomTask">Add Task</button>
<ul id="customList"></ul>

<br>
<label>Daily Reset Time:</label>
<input type="time" id="resetTime">
<button id="manualReset">Manual Reset</button>
</div>

<script>
/* ===== STORAGE HELPERS ===== */
const load = (key, def) => JSON.parse(localStorage.getItem(key) || JSON.stringify(def));
const save = (key, val) => localStorage.setItem(key, JSON.stringify(val));

/* ===== GLOBAL DAILY TASKS ===== */
let dailyTasksGlobal = load("dailyTasksGlobal", [
  {text:"Wake up early"},
  {text:"Workout"},
  {text:"Breakfast"},
  {text:"Work/Study"},
  {text:"Dinner"}
]);

/* ===== DATE PICKER ===== */
let selectedDate = new Date().toISOString().split("T")[0]; // YYYY-MM-DD
document.getElementById("datePicker").value = selectedDate;

/* ===== CHECKLIST HISTORY ===== */
function getHistory(){ return load("checklistHistory", {}); }
function saveHistory(h){ save("checklistHistory", h); }
function ensureDateExists(date){
  const history = getHistory();
  if(!history[date]){
    history[date] = { dailyTasksDone: dailyTasksGlobal.map(()=>false), customTasks: [] };
    saveHistory(history);
  }
}

/* ===== RENDER DAILY TASKS ===== */
const dailyList = document.getElementById("dailyList");
let draggedDailyIndex = null;

function renderDailyTasks(){
  ensureDateExists(selectedDate);
  const history = getHistory();
  const doneArray = history[selectedDate].dailyTasksDone;

  dailyList.innerHTML="";
  dailyTasksGlobal.forEach((t,i)=>{
    const li = document.createElement("li");
    li.draggable = true;
    li.dataset.index = i;
    li.innerHTML = `
      <span><input type="checkbox" ${doneArray[i]?"checked":""}> ${t.text}</span>
      <button class="editBtn">âœŽ</button>
    `;
    // checkbox toggle
    li.querySelector("input").onchange = e=>{
      const history = getHistory();
      history[selectedDate].dailyTasksDone[i] = e.target.checked;
      saveHistory(history);
    };
    // edit text
    li.querySelector(".editBtn").onclick = ()=>{
      const newText = prompt("Edit daily task:", dailyTasksGlobal[i].text);
      if(newText!==null && newText.trim()!==""){
        dailyTasksGlobal[i].text = newText.trim();
        save("dailyTasksGlobal", dailyTasksGlobal);
        renderDailyTasks();
      }
    };
    // drag and drop to reorder
    li.addEventListener("dragstart", ()=>{ draggedDailyIndex=i; });
    li.addEventListener("dragover", e=>e.preventDefault());
    li.addEventListener("drop", ()=>{
      const [moved] = dailyTasksGlobal.splice(draggedDailyIndex,1);
      dailyTasksGlobal.splice(i,0,moved);
      save("dailyTasksGlobal", dailyTasksGlobal);
      const history = getHistory();
      const doneMoved = history[selectedDate].dailyTasksDone.splice(draggedDailyIndex,1)[0];
      history[selectedDate].dailyTasksDone.splice(i,0,doneMoved);
      saveHistory(history);
      renderDailyTasks();
    });
    dailyList.appendChild(li);
  });
}

/* ===== CUSTOM TASKS ===== */
const customList = document.getElementById("customList");
let draggedCustomIndex = null;

function renderCustomTasks(){
  ensureDateExists(selectedDate);
  const history = getHistory();
  const tasks = history[selectedDate].customTasks;

  customList.innerHTML="";
  tasks.forEach((t,i)=>{
    const li=document.createElement("li");
    li.draggable = true;
    li.dataset.index = i;
    li.innerHTML = `<span><input type="checkbox" ${t.done?"checked":""}> ${t.text}</span>
                    <button>X</button>`;
    li.querySelector("input").onchange = e=>{
      const history = getHistory();
      history[selectedDate].customTasks[i].done = e.target.checked;
      saveHistory(history);
    };
    li.querySelector("button").onclick = ()=>{
      const history = getHistory();
      history[selectedDate].customTasks.splice(i,1);
      saveHistory(history);
      renderCustomTasks();
    };
    li.addEventListener("dragstart", ()=>{ draggedCustomIndex=i; });
    li.addEventListener("dragover", e=>e.preventDefault());
    li.addEventListener("drop", ()=>{
      const history = getHistory();
      const [moved] = history[selectedDate].customTasks.splice(draggedCustomIndex,1);
      history[selectedDate].customTasks.splice(i,0,moved);
      saveHistory(history);
      renderCustomTasks();
    });
    customList.appendChild(li);
  });
}

document.getElementById("addCustomTask").onclick = ()=>{
  const input = document.getElementById("customTaskInput");
  if(!input.value.trim()) return;
  ensureDateExists(selectedDate);
  const history = getHistory();
  history[selectedDate].customTasks.push({text: input.value.trim(), done:false});
  saveHistory(history);
  input.value="";
  renderCustomTasks();
};

/* ===== DATE PICKER HANDLER ===== */
document.getElementById("datePicker").onchange = e=>{
  selectedDate = e.target.value;
  renderDailyTasks();
  renderCustomTasks();
};

/* ===== RESET SYSTEM ===== */
const resetInput = document.getElementById("resetTime");
resetInput.value = localStorage.getItem("resetTime") || "04:00";
resetInput.onchange = ()=> localStorage.setItem("resetTime", resetInput.value);

document.getElementById("manualReset").onclick = ()=>{
  ensureDateExists(selectedDate);
  const history = getHistory();
  history[selectedDate].dailyTasksDone = dailyTasksGlobal.map(()=>false);
  saveHistory(history);
  renderDailyTasks();
};

function checkDailyReset(){
  const time = localStorage.getItem("resetTime");
  if(!time) return;
  const now = new Date();
  const today = now.toDateString();
  if(localStorage.getItem("lastReset") === today) return;
  const [h,m] = time.split(":");
  if(now.getHours()>=h && now.getMinutes()>=m){
    ensureDateExists(selectedDate);
    const history = getHistory();
    history[selectedDate].dailyTasksDone = dailyTasksGlobal.map(()=>false);
    saveHistory(history);
    localStorage.setItem("lastReset",today);
    renderDailyTasks();
  }
}
setInterval(checkDailyReset,30000);

/* ===== INIT ===== */
ensureDateExists(selectedDate);
renderDailyTasks();
renderCustomTasks();
</script>
</body>
</html>
